{% extends 'customer/base.html' %}
{% block title %}Leave a Review - DriveEase{% endblock %}
{% block content %}
<div class="card" style="max-width: 600px; margin: 2rem auto;">
    <div class="card-header">
        <h2 class="card-title">Leave a Review</h2>
        <p class="card-subtitle">Share your experience for Booking #{{ booking.id }} ({{ booking.make }} {{ booking.model }}, {{ booking.year }})</p>
    </div>
    <div class="card-body">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}
        <form method="POST" novalidate id="review-form">
            <div class="form-group">
                <label for="star-rating" class="form-label">Overall Rating</label>
                <div class="star-rating" id="star-rating">
                    {% for i in range(1, 6) %}
                        <span class="star" data-value="{{ i }}">&#9733;</span>
                    {% endfor %}
                </div>
                <input type="hidden" name="rating" id="rating" required>
                <div class="form-hint" id="rating-hint">Click to rate</div>
            </div>
            <div class="form-group">
                <label for="comment" class="form-label">Your Review</label>
                <textarea name="comment" id="comment" class="form-input" rows="5" maxlength="500" required placeholder="Share your experience (at least 10 characters)"></textarea>
                <div class="form-hint" id="char-count">0/500</div>
            </div>
            <div class="form-group">
                <label for="recommend" class="form-label">Would you recommend us?</label>
                <select name="recommend" id="recommend" class="form-input custom-dropdown" required>
                    <option value="">Select an option</option>
                    <option value="yes">Yes</option>
                    <option value="maybe">Maybe</option>
                    <option value="no">No</option>
                </select>
            </div>
            <div class="form-group">
                <label for="condition_rating" class="form-label">Vehicle Condition</label>
                <select name="condition_rating" id="condition_rating" class="form-input" required>
                    <option value="">Select rating</option>
                    {% for i in range(1, 6) %}
                        <option value="{{ i }}">{{ i }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="service_rating" class="form-label">Service Quality</label>
                <select name="service_rating" id="service_rating" class="form-input" required>
                    <option value="">Select rating</option>
                    {% for i in range(1, 6) %}
                        <option value="{{ i }}">{{ i }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="value_rating" class="form-label">Value for Money</label>
                <select name="value_rating" id="value_rating" class="form-input" required>
                    <option value="">Select rating</option>
                    {% for i in range(1, 6) %}
                        <option value="{{ i }}">{{ i }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-full">Submit Review</button>
                <a href="{{ url_for('customer_bookings') }}" class="btn btn-ghost btn-full">Cancel</a>
            </div>
        </form>
    </div>
</div>
<style>
.star-rating { display: flex; gap: 0.5em; font-size: 2rem; color: #ccc; cursor: pointer; }
.star-rating .star.selected, .star-rating .star.hovered { color: #f5b301; }
.form-hint { font-size: 0.9em; color: var(--neutral-500); margin-top: 0.25em; }
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Star rating widget
    const stars = document.querySelectorAll('#star-rating .star');
    const ratingInput = document.getElementById('rating');
    let currentRating = 0;
    stars.forEach(star => {
        star.addEventListener('mouseenter', function() {
            const val = parseInt(this.dataset.value);
            stars.forEach((s, i) => s.classList.toggle('hovered', i < val));
        });
        star.addEventListener('mouseleave', function() {
            stars.forEach((s, i) => s.classList.toggle('hovered', i < currentRating));
        });
        star.addEventListener('click', function() {
            currentRating = parseInt(this.dataset.value);
            ratingInput.value = currentRating;
            stars.forEach((s, i) => s.classList.toggle('selected', i < currentRating));
            document.getElementById('rating-hint').textContent = `You rated ${currentRating} star${currentRating > 1 ? 's' : ''}`;
        });
    });
    // Char counter
    const comment = document.getElementById('comment');
    const charCount = document.getElementById('char-count');
    comment.addEventListener('input', function() {
        charCount.textContent = `${this.value.length}/500`;
    });
});
</script>
{% endblock %} 