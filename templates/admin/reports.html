<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - Premium Car Rentals</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <nav class="container">
            <div class="logo">Premium Car Rentals Admin</div>
            <ul class="nav-links">
                <li><a href="{{ url_for('admin_dashboard') }}">Dashboard</a></li>
                <li><a href="{{ url_for('admin_manage_vehicles') }}">Vehicles</a></li>
                <li><a href="{{ url_for('admin_reports') }}">Reports</a></li>
                <li><a href="{{ url_for('logout') }}">Logout</a></li>
            </ul>
        </nav>
    </header>

    <main class="container" style="padding: 2rem 0;">
        <div class="card mb-5">
            <h1 class="card-title">Business Reports</h1>
            <p style="color: #6b7280;">Comprehensive analytics and insights for your car rental business.</p>
        </div>

        <!-- Summary Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ stats.total_bookings or 0 }}</div>
                <div class="stat-label">Total Bookings</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.completed_bookings or 0 }}</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.pending_bookings or 0 }}</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${{ "%.0f"|format(stats.total_revenue or 0) }}</div>
                <div class="stat-label">Total Revenue</div>
            </div>
        </div>

        <div class="grid grid-2">
            <!-- Popular Vehicles -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Popular Vehicles</h2>
                </div>
                {% if popular_vehicles %}
                    <div class="table-container" style="overflow-x: auto;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Vehicle</th>
                                    <th>Type</th>
                                    <th>Bookings</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for vehicle in popular_vehicles[:10] %}
                                <tr>
                                    <td style="font-weight: 600; color: #3b82f6;">{{ loop.index }}</td>
                                    <td>
                                        <div style="font-weight: 600;">{{ vehicle.make }} {{ vehicle.model }}</div>
                                    </td>
                                    <td style="color: #6b7280;">{{ vehicle.type }}</td>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <div style="background: #3b82f6; height: 4px; border-radius: 2px; 
                                                        width: {{ (vehicle.booking_count / (popular_vehicles[0].booking_count if popular_vehicles[0].booking_count > 0 else 1) * 100)|int }}px; 
                                                        min-width: 10px;"></div>
                                            <span style="font-weight: 600;">{{ vehicle.booking_count }}</span>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p style="color: #6b7280; text-align: center;">No booking data available yet.</p>
                {% endif %}
            </div>

            <!-- Revenue Breakdown -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Revenue Breakdown</h2>
                </div>
                <div class="grid" style="gap: 1rem;">
                    <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(6, 182, 212, 0.1)); 
                                border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 12px; padding: 1.5rem;">
                        <div style="font-size: 1.25rem; font-weight: bold; color: #3b82f6; margin-bottom: 0.5rem;">
                            ${{ "%.2f"|format(stats.total_revenue or 0) }}
                        </div>
                        <div style="color: #6b7280; font-size: 0.875rem;">Total Revenue</div>
                    </div>
                    
                    {% if stats.completed_bookings and stats.completed_bookings > 0 %}
                    <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1)); 
                                border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 12px; padding: 1.5rem;">
                        <div style="font-size: 1.25rem; font-weight: bold; color: #22c55e; margin-bottom: 0.5rem;">
                            ${{ "%.2f"|format((stats.total_revenue or 0) / stats.completed_bookings) }}
                        </div>
                        <div style="color: #6b7280; font-size: 0.875rem;">Average per Booking</div>
                    </div>
                    {% endif %}
                    
                    <div style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(234, 88, 12, 0.1)); 
                                border: 1px solid rgba(249, 115, 22, 0.2); border-radius: 12px; padding: 1.5rem;">
                        <div style="font-size: 1.25rem; font-weight: bold; color: #f97316; margin-bottom: 0.5rem;">
                            {{ "%.1f"|format(((stats.completed_bookings or 0) / (stats.total_bookings or 1)) * 100) }}%
                        </div>
                        <div style="color: #6b7280; font-size: 0.875rem;">Completion Rate</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Booking Status Distribution -->
        <div class="card mt-5">
            <div class="card-header">
                <h2 class="card-title">Booking Status Distribution</h2>
            </div>
            <div class="grid grid-4">
                <div style="text-align: center; padding: 1.5rem;">
                    <div style="font-size: 2rem; font-weight: bold; color: #f59e0b; margin-bottom: 0.5rem;">
                        {{ stats.pending_bookings or 0 }}
                    </div>
                    <div style="color: #6b7280;">Pending</div>
                    <div style="background: #f59e0b; height: 4px; border-radius: 2px; margin-top: 0.5rem;
                                width: {{ ((stats.pending_bookings or 0) / (stats.total_bookings or 1) * 100)|int }}%;"></div>
                </div>
                
                <div style="text-align: center; padding: 1.5rem;">
                    <div style="font-size: 2rem; font-weight: bold; color: #3b82f6; margin-bottom: 0.5rem;">
                        {{ stats.approved_bookings or 0 }}
                    </div>
                    <div style="color: #6b7280;">Approved</div>
                    <div style="background: #3b82f6; height: 4px; border-radius: 2px; margin-top: 0.5rem;
                                width: {{ ((stats.approved_bookings or 0) / (stats.total_bookings or 1) * 100)|int }}%;"></div>
                </div>
                
                <div style="text-align: center; padding: 1.5rem;">
                    <div style="font-size: 2rem; font-weight: bold; color: #22c55e; margin-bottom: 0.5rem;">
                        {{ stats.completed_bookings or 0 }}
                    </div>
                    <div style="color: #6b7280;">Completed</div>
                    <div style="background: #22c55e; height: 4px; border-radius: 2px; margin-top: 0.5rem;
                                width: {{ ((stats.completed_bookings or 0) / (stats.total_bookings or 1) * 100)|int }}%;"></div>
                </div>
                
                <div style="text-align: center; padding: 1.5rem;">
                    <div style="font-size: 2rem; font-weight: bold; color: #6b7280; margin-bottom: 0.5rem;">
                        {{ (stats.total_bookings or 0) - (stats.pending_bookings or 0) - (stats.approved_bookings or 0) - (stats.completed_bookings or 0) }}
                    </div>
                    <div style="color: #6b7280;">Other</div>
                    <div style="background: #6b7280; height: 4px; border-radius: 2px; margin-top: 0.5rem;
                                width: {{ (((stats.total_bookings or 0) - (stats.pending_bookings or 0) - (stats.approved_bookings or 0) - (stats.completed_bookings or 0)) / (stats.total_bookings or 1) * 100)|int }}%;"></div>
                </div>
            </div>
        </div>

        <!-- Export Options -->
        <div class="card mt-5">
            <div class="card-header">
                <h2 class="card-title">Export Data</h2>
            </div>
            <div class="grid grid-3">
                <button class="btn btn-secondary" onclick="exportData('bookings')">
                    Export Bookings (CSV)
                </button>
                <button class="btn btn-secondary" onclick="exportData('revenue')">
                    Export Revenue Report
                </button>
                <button class="btn btn-secondary" onclick="exportData('vehicles')">
                    Export Vehicle Performance
                </button>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        function exportData(type) {
            CarRentalApp.showSuccessMessage(`Exporting ${type} data...`);
            
            // In a real implementation, this would trigger a download
            setTimeout(() => {
                CarRentalApp.showSuccessMessage(`${type.charAt(0).toUpperCase() + type.slice(1)} data exported successfully!`);
            }, 2000);
        }
    </script>
</body>
</html>